<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPad POS ç³»çµ±</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background-color: #f2f2f7; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 220px; padding: 20px; display: flex; flex-direction: column; gap: 15px; border-right: 1px solid #d1d1d6; padding-top: 50px; }
        .product-btn { width: 100%; height: 120px; border-radius: 20px; border: none; font-weight: 900; font-size: 40px; color: white; cursor: pointer; opacity: 0.5; transition: 0.2s; }
        .product-btn.active { opacity: 1; transform: scale(1.05); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .bg-orange { background-color: #ff9500; }
        .bg-blue { background-color: #007aff; }
        .bg-yellow { background-color: #ffcc00; }
        
        #main-content { flex: 1; background-color: white; display: flex; flex-direction: column; padding: 0 40px; }
        
        #display-area { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 60px; margin-bottom: 20px; height: 140px; }
        .input-group { display: flex; flex-direction: column; width: 45%; }
        .input-label { font-size: 45px; font-weight: bold; color: #888; margin-right: 10px; }
        .input-value { font-size: 110px; font-weight: 900; line-height: 1; text-align: right; height: 110px; flex: 1; letter-spacing: -2px; }
        .input-line { height: 6px; background-color: black; border-radius: 3px; margin-top: 5px; }

        #keypads-container { display: flex; justify-content: center; gap: 50px; margin-top: 10px; }
        .keypad { display: grid; grid-template-columns: repeat(3, 100px); gap: 15px; }
        .key-btn { width: 100px; height: 100px; border-radius: 50%; background-color: #e5e5ea; border: none; font-size: 40px; font-weight: bold; }
        .key-btn:active { background-color: #c7c7cc; }
        
        #submit-btn { width: 450px; height: 100px; border-radius: 30px; background-color: #c7c7cc; color: white; font-size: 50px; font-weight: bold; border: none; margin: 30px auto; transition: 0.3s; }
        #submit-btn.ready { background-color: #ff3b30; cursor: pointer; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="product-btn bg-orange" onclick="selectProduct('D', this)">D</button>
    <button class="product-btn bg-blue" onclick="selectProduct('è—', this)">è—</button>
    <button class="product-btn bg-yellow" onclick="selectProduct('è§’', this)">è§’</button>
    <div style="flex:1;"></div>
    <div onclick="openReport()" style="text-align:center; cursor:pointer; padding: 10px;">
        <div style="font-size:45px;">ğŸ“Š</div><div style="font-weight:bold;color:#888;font-size:18px;">æŸ¥çœ‹ç´€éŒ„</div>
    </div>
</div>

<div id="main-content">
    <div id="display-area">
        <div class="input-group">
            <div style="display:flex; align-items:baseline;"><span class="input-label">ä»¶:</span><div id="qty-display" class="input-value"></div></div>
            <div class="input-line"></div>
        </div>
        <div class="input-group">
            <div style="display:flex; align-items:baseline;"><span class="input-label">$:</span><div id="price-display" class="input-value"></div></div>
            <div class="input-line"></div>
        </div>
    </div>

    <div id="keypads-container">
        <div class="keypad" id="qty-keypad"></div>
        <div class="keypad" id="price-keypad"></div>
    </div>
    <button id="submit-btn" onclick="submitTransaction()">è¼¸ å…¥</button>
</div>

<script>
    // â–¼â–¼â–¼ è«‹åœ¨ä¸‹æ–¹å¡«å…¥æ‚¨çš„ Google Apps Script ç¶²å€ â–¼â–¼â–¼
    const GOOGLE_SCRIPT_URL = " https://script.google.com/macros/s/AKfycbwW4FsW2qvo9-0vHvcW6DagQ5WM_RXGWMv12AYOro1jDmJ0_ni_vFDn0fCl4K-PzBDu/exec"; 
    
    let selectedProduct = "", qtyInput = "", priceInput = "";
    const keys = ["7", "8", "9", "4", "5", "6", "1", "2", "3", "0", "", "âŒ«"];

    function createKeypad(id, isPrice) {
        const container = document.getElementById(id);
        keys.forEach(k => {
            const btn = document.createElement("button");
            btn.className = "key-btn";
            btn.innerText = k;
            if(k !== "") btn.onclick = () => handleInput(k, isPrice);
            if(k === "") btn.style.visibility = "hidden";
            container.appendChild(btn);
        });
    }

    function handleInput(k, isPrice) {
        if (isPrice) {
            if (k === "âŒ«") {
                priceInput = priceInput.slice(0, -1);
            } else {
                // é‚è¼¯ 1: é‡‘é¡é•·åº¦é™åˆ¶ç‚º 4 ä½ (æœ€é«˜ 9990)
                if (priceInput.length >= 4) return;
                
                // é‚è¼¯ 2: å¦‚æœå·²ç¶“è¼¸å…¥ 3 ä½æ•¸ï¼Œç¬¬ 4 ä½æ•¸åªèƒ½è¼¸å…¥ "0"
                if (priceInput.length === 3 && k !== "0") return;
                
                // é‚è¼¯ 3: å€‹ä½æ•¸é™åˆ¶ (æœ€å¾Œä¸€ä½ä¸€å®šè¦æ˜¯ 0) 
                // é€™è£¡æˆ‘å€‘æ›´é€²ä¸€æ­¥ï¼šåªå…è¨±åœ¨æœ€å¾Œä¸€ä½è¼¸å…¥ 0
                // ä½†ç‚ºäº†éˆæ´»ï¼Œæˆ‘å€‘è®“æ‚¨è‡ªå·±æŒ‰ã€‚å¦‚æœæ‚¨æŒ‰å®Œå¾Œæœ€å¾Œä¸€ä½ä¸æ˜¯ 0ï¼Œè¼¸å…¥æŒ‰éˆ•ä¸æœƒè®Šç´…
                priceInput += k;
            }
        } else {
            if (k === "âŒ«") qtyInput = qtyInput.slice(0, -1);
            else if (qtyInput.length < 3) qtyInput += k;
        }
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById("qty-display").innerText = qtyInput;
        document.getElementById("price-display").innerText = priceInput;
        
        const btn = document.getElementById("submit-btn");
        
        // åˆ¤å®šæ˜¯å¦å¯ä»¥ã€Œè¼¸å…¥ã€ï¼š
        // 1. å·²é¸ç”¢å“ã€ä»¶æ•¸ã€é‡‘é¡
        // 2. é‡‘é¡å€‹ä½æ•¸å¿…é ˆç‚º "0"
        // 3. é‡‘é¡ä¸å¯è¶…é 9990
        const isPriceValid = priceInput.endsWith("0") && parseInt(priceInput) <= 9990;

        if (selectedProduct && qtyInput && priceInput && isPriceValid) {
            btn.classList.add("ready");
        } else {
            btn.classList.remove("ready");
        }
    }

    function selectProduct(p, btn) {
        selectedProduct = p;
        document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        updateDisplay();
    }

    function submitTransaction() {
        const btn = document.getElementById("submit-btn");
        if (!btn.classList.contains("ready")) return;

        const data = {
            secret: "MyShop2024",
            timestamp: new Date().toLocaleString(),
            product: selectedProduct,
            qty: qtyInput,
            price: priceInput
        };
        
        fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
        
        qtyInput = ""; priceInput = ""; selectedProduct = "";
        document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('active'));
        updateDisplay();
    }

    function openReport() { 
        if(GOOGLE_SCRIPT_URL.includes("æ‚¨çš„")) alert("è«‹å…ˆå¡«å…¥ç¶²å€");
        else window.location.href = GOOGLE_SCRIPT_URL; 
    }

    createKeypad("qty-keypad", false);
    createKeypad("price-keypad", true);
</script>
</body>
</html>
