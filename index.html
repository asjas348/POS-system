<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPad POS ç³»çµ±</title>
    <style>
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, sans-serif;
            background-color: #f2f2f7;
            display: flex; height: 100vh; overflow: hidden;
        }

        /* --- å´é‚Šæ¬„ --- */
        #sidebar {
            width: 280px; background-color: #f2f2f7; padding: 20px;
            display: flex; flex-direction: column; gap: 20px;
            border-right: 1px solid #d1d1d6; padding-top: 60px;
        }

        .product-btn {
            width: 100%; height: 150px;
            border-radius: 25px; border: none;
            font-weight: 900; font-size: 45px; color: white;
            cursor: pointer; opacity: 0.5; transition: all 0.2s;
        }

        /* é¸ä¸­å¾Œï¼šå­—é«”åŠ å¤§ 2 å€ä»¥ä¸Š (100px)ï¼Œä¸¦è®Šè‰² */
        .product-btn.active {
            opacity: 1; color: #000;
            font-size: 100px !important; 
            background-color: #ffffff !important;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            border: 8px solid #34c759; /* é¸ä¸­æ™‚åŠ å€‹ç¶ æ¡†æ›´æ˜é¡¯ */
        }

        .bg-orange { background-color: #ff9500; }
        .bg-blue { background-color: #007aff; }
        .bg-yellow { background-color: #ffcc00; }

        /* --- ä¸»å€åŸŸ --- */
        #main-content {
            flex: 1; background-color: white;
            display: flex; flex-direction: column; padding: 0 40px;
        }

        #display-area {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-top: 50px; margin-bottom: 30px;
        }

        .input-group { display: flex; flex-direction: column; width: 42%; }
        .input-row { display: flex; align-items: baseline; }
        .input-label { font-size: 45px; font-weight: bold; color: #888; margin-right: 10px; }
        .input-value {
            font-size: 110px; font-weight: 900; line-height: 1;
            text-align: right; flex: 1; height: 110px;
        }
        .input-line { height: 8px; background-color: black; width: 100%; border-radius: 4px; }

        /* --- éµç›¤ä½ˆå±€ï¼šå¾¹åº•åˆ†é–‹ --- */
        #keypads-container { 
            display: flex; 
            justify-content: space-between; /* é—œéµï¼šå¼·åˆ¶æ¨å‘å…©é‚Š */
            margin-top: 20px;
            padding: 0 10px;
        }

        .keypad { 
            display: grid; 
            grid-template-columns: repeat(3, 115px); /* å¯¬åº¦åŠ å¤§ */
            gap: 20px; 
        }

        .key-btn {
            width: 115px; height: 115px; border-radius: 50%;
            background-color: #e5e5ea; border: none;
            font-size: 65px; /* æ•¸å­—å¤§å¹…åŠ å¤§ */
            font-weight: 900; color: black; cursor: pointer;
        }
        .key-btn:active { background-color: #acacb0; }
        .key-btn.back { font-size: 40px; } /* é€€æ ¼éµç¨å¾®å°ä¸€é» */

        /* --- ä¸‹æ–¹æŒ‰éˆ• --- */
        #submit-btn {
            width: 500px; height: 110px; border-radius: 30px;
            background-color: #c7c7cc; color: white;
            font-size: 55px; font-weight: 900; border: none;
            margin: 40px auto; transition: 0.3s;
        }
        #submit-btn.ready { background-color: #ff3b30; }
        #error-hint { color: red; font-weight: bold; text-align: right; visibility: hidden; }
    </style>
</head>
<body>

    <div id="sidebar">
        <button class="product-btn bg-orange" onclick="selectProduct('D', this)">D</button>
        <button class="product-btn bg-blue" onclick="selectProduct('è—', this)">è—</button>
        <button class="product-btn bg-yellow" onclick="selectProduct('è§’', this)">è§’</button>
        <div style="flex:1;"></div>
        <button onclick="openReport()" style="font-size:30px; background:none; border:none; cursor:pointer;">ğŸ“Š å ±è¡¨</button>
    </div>

    <div id="main-content">
        <div id="display-area">
            <div class="input-group">
                <div class="input-row"><span class="input-label">ä»¶:</span><div id="qty-display" class="input-value"></div></div>
                <div class="input-line"></div>
            </div>
            <div class="input-group">
                <div class="input-row"><span class="input-label">$:</span><div id="price-display" class="input-value"></div></div>
                <div class="input-line"></div>
                <div id="error-hint">å€‹ä½æ•¸å¿…é ˆç‚º 0</div>
            </div>
        </div>

        <div id="keypads-container">
            <div class="keypad" id="qty-keypad"></div>
            <div class="keypad" id="price-keypad"></div>
        </div>

        <button id="submit-btn" onclick="submitTransaction()">è¼¸ å…¥</button>
    </div>

    <script>
        // â–¼ è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ Google Web App ç¶²å€ â–¼
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzQDjKlDYNXUvBkfMy3Dwp_R8enAqSZEgbDVDHID_xVpSY-cc2oHwEDc3yzoEtAzVgB/exec"; 
        const SECRET_KEY = "MyShop2024";

        let selectedProduct = "", qtyInput = "", priceInput = "";
        const keys = ["7", "8", "9", "4", "5", "6", "1", "2", "3", "0", "", "âŒ«"];

        function createKeypad(elementId, isPrice) {
            const container = document.getElementById(elementId);
            keys.forEach(key => {
                if (key === "") {
                    container.appendChild(document.createElement("div"));
                } else {
                    const btn = document.createElement("button");
                    btn.className = "key-btn" + (key === "âŒ«" ? " back" : "");
                    btn.innerText = key;
                    btn.onclick = () => {
                        if (isPrice) {
                            if (key === "âŒ«") priceInput = priceInput.slice(0, -1);
                            else if (priceInput.length < 4) priceInput += key;
                        } else {
                            if (key === "âŒ«") qtyInput = qtyInput.slice(0, -1);
                            else if (qtyInput.length < 3) qtyInput += key;
                        }
                        updateDisplay();
                    };
                    container.appendChild(btn);
                }
            });
        }

        function selectProduct(name, btn) {
            selectedProduct = name;
            document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById("qty-display").innerText = qtyInput;
            document.getElementById("price-display").innerText = priceInput;
            const btn = document.getElementById("submit-btn");
            const err = document.getElementById("error-hint");

            const isPriceOk = priceInput.length > 0 && priceInput.endsWith("0");
            err.style.visibility = (priceInput.length > 0 && !priceInput.endsWith("0")) ? "visible" : "hidden";

            if (selectedProduct && qtyInput && isPriceOk) btn.classList.add("ready");
            else btn.classList.remove("ready");
        }

        function submitTransaction() {
            const btn = document.getElementById("submit-btn");
            if (!btn.classList.contains("ready")) return;

            btn.innerText = "å‚³é€ä¸­..."; btn.classList.remove("ready");

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({
                    secret: SECRET_KEY,
                    timestamp: new Date().toLocaleString('zh-TW', { hour12: false }),
                    product: selectedProduct,
                    qty: qtyInput,
                    price: priceInput
                }),
                headers: { "Content-Type": "text/plain;charset=utf-8" }
            })
            .then(() => {
                qtyInput = ""; priceInput = ""; selectedProduct = "";
                document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('active'));
                updateDisplay();
                btn.innerText = "å®Œæˆ OK";
                setTimeout(() => { btn.innerText = "è¼¸ å…¥"; }, 1000);
            })
            .catch(() => { alert("é€£ç·šå¤±æ•—"); btn.classList.add("ready"); });
        }

        function openReport() { window.open(GOOGLE_SCRIPT_URL, '_blank'); }
        createKeypad("qty-keypad", false);
        createKeypad("price-keypad", true);
    </script>
</body>
</html>
